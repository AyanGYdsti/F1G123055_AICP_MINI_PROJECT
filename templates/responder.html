{% extends "base.html" %}

{% block content %}
<div class="mb-4">
    <h2 class="fw-bold">ðŸ’¬ Asisten Chat & Review</h2>
    <p class="text-muted">AI pintar yang tahu cara menghadapi pembeli. Sistem akan mendeteksi nada bicara: <b>Meminta maaf dengan tulus</b> saat ada masalah, atau <b>berterima kasih dengan ceria</b> saat dapat pujian.</p>
</div>

<div class="row">
    <div class="col-md-5">
        <form method="POST" class="card p-4 shadow-sm border-0 bg-light">
            <div class="mb-3">
                <label class="form-label fw-bold">Salin Review Pelanggan</label>
                <textarea name="komplain" class="form-control" rows="5" 
                    placeholder="Contoh Komplain: 'Barang pecah nih! Kecewa!' atau 'Wah paketnya rapi banget kak, makasih!'" required></textarea>
            </div>
            <button type="submit" class="btn btn-danger w-100 ">
                Generate Balasanâš¡
            </button>
        </form>
    </div>
    
    <div class="col-md-7">
        {% if result %}
        <div class="result-box mt-3 mt-md-0 shadow-sm" style="border-left: 5px solid #dc3545; padding: 25px; background: white; border-radius: 8px;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0 text-danger fw-bold">âœ¨ Saran Balasan AI:</h5>
                <button onclick="copyText()" id="copyBtn" class="btn btn-sm btn-outline-danger">
                    ðŸ“‹ Salin Teks
                </button>
            </div>
            <hr>
            <div id="hasilResponder" class="markdown-result text-secondary">
                {{ result | safe }}
            </div>
            <div class="mt-3 text-end">
                <small class="text-muted fst-italic">*Silakan edit sedikit sesuai gaya bahasamu sebelum dikirim.</small>
            </div>
        </div>
        {% else %}
        <div class="d-flex align-items-center justify-content-center h-100 text-center text-muted border rounded-3 p-4" style="border-style: dashed !important; background-color: #f8f9fa;">
            <div>
                <p class="mb-0">Belum ada input. <br>Masukkan chat atau review pelanggan di samping (baik/buruk) untuk melihat hasilnya. âœ¨</p>
            </div>
        </div>
        {% endif %}
    </div>
</div>
<script>
    function copyText() {
        var textElement = document.getElementById("hasilResponder");
        
        navigator.clipboard.writeText(textElement.innerText).then(function() {
            var btn = document.getElementById("copyBtn");
            var originalText = btn.innerHTML;
            
            // Ubah tombol jadi feedback sukses
            btn.innerHTML = "âœ… Tersalin!";
            btn.classList.remove("btn-outline-danger");
            btn.classList.add("btn-success");
            
            // Kembalikan tombol setelah 2 detik
            setTimeout(function() {
                btn.innerHTML = originalText;
                btn.classList.remove("btn-success");
                btn.classList.add("btn-outline-danger");
            }, 2000);
        }).catch(function(err) {
            console.error('Gagal menyalin: ', err);
            alert("Gagal menyalin otomatis.");
        });
    }
</script>
{% endblock %}